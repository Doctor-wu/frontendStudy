## 主机间通信

主机间通信可以直接用一条交叉线链接两台主机

主机间发包通过**ICMP**协议进行**IP**层面的通信

若不知道目标主机的MAC地址，在发**ICMP**之前需要发送**ARP**广播找到目标主机的MAC地址



### ARP协议

**ARP协议会在主机间广播获取到各个主机的MAC地址与IP地址的映射**

ARP地址在设备本地是有缓存的



### **ICMP协议**

**ICMP协议是一个网络层协议。**

一个新搭建好的网络，往往需要先进行一个简单的测试，来验证网络是否畅通；但是IP协议并不提供可靠传输。如果丢包了，IP协议并不能通知传输层是否丢包以及丢包的原因，所以我们就需要一种协议来完成这样的功能–ICMP协议。

ICMP协议的功能主要有：

1. 确认IP包是否成功到达目标地址
2. 通知在发送过程中IP包被丢弃的原因
3. ICMP是基于IP协议工作的，但是它并不是传输层的功能，因此仍然把它归结为网络层协议
4. ICMP只能搭配IPv4使用，如果是IPv6的情况下, 需要是用ICMPv6



### 局域网内多台主机间的通信

#### 总线形式

多台计算机连接在同一条同轴电缆，这种方式是半双工通信

同轴电缆的传播方式是广播，容易造成碰撞，可以借助**碰撞检测协议**来实现信息的传递

同轴电缆两端是电阻会吸收信号，避免信号回弹

容错率低，如果总线断了，那么信号可能不会遇到电阻造成信号回弹

一条总线连接的所有主机称为一个**冲突域**



#### 集线器形式

用集线器把所有主机连起来，可以用集线器连接集线器，来拓展网络

容错率好，一台主机失联对全局影响不大

**集线器没有智商，给集线器发包，集线器只会把包发往其它所有连接的端口**

如果多台主机连在同一个集线器上，会造成发送过多的无用包导致性能浪费



#### 网桥连接

**网桥连接能够通过自学习得知每个接口那侧的MAC地址**

网桥只有两个接口

网桥内部会有一个MAC地址表

| 端口 | MAC地址 |
| ---- | ------- |
| L    | MAC(1)  |
| R    | MAC(2)  |
| L    | MAC(3)  |
| L    | MAC(4)  |
| R    | MAC(5)  |
| ...  | ...     |

网桥在转发数据包时，如果发现数据包的目的地和它来的端口是同一个端口，那么网桥不会转发这个包，从而起到隔绝冲突域的作用



#### 交换机

相当于更多接口的网桥

**全双工通信**

**交换机是局域网的最终方案，若要跨网段，则要用到路由器**

交换机也会学习各个接口对应的MAC地址，若要转发的包在MAC地址表内找到匹配端口，则交换机只会把包转到对应的端口而不会影响其他端口

但是如果全球都用交换机连接是不可行的

1. 首先交换机连接的是同一个网段的主机，会造成IP地址不够用
2. ARP广播会发给全球的人

**所以说如果要连接多个网络的话，交换机还是不能解决问题**

